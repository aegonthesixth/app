<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIPLOMACY MUN Committee Timer</title>
<style>
:root {
/* Modern theme configuration */
--primary: #6750A4;
--secondary: #625B71;
--accent: #7D5260;
--success: #4CAF50;
--warning: #FFA726;
--danger: #F44336;

--bg-primary: #F8F8FC;
--bg-secondary: #F0F0F6;
--bg-elevated: #FFFFFF;

--text-primary: #1C1B1F;
--text-secondary: #49454F;
--text-disabled: #9E9E9E;
--text-on-primary: #FFFFFF;

--border: #E0E0E6;
--highlight: #E8DEF8;

--timer-green: #4CAF50;
--timer-blue: #03A9F4;
--timer-orange: #FF9800;

--corner-radius: 8px;
--border-width: 1px;
--padding: 10px;

--font-family: 'Segoe UI', system-ui, sans-serif;
}

body {
font-family: var(--font-family);
background-color: var(--bg-primary);
margin: 0;
padding: 0;
color: var(--text-primary);
}

#app {
width: 100%;
max-width: 1600px;
margin: 0 auto;
min-height: 100vh;
}
/* Greek Academy styling */
.header-content {
  display: flex;
  align-items: center;
  z-index: 2;
}

.greek-academy {
  margin-right: 15px;
  display: flex;
  align-items: flex-end;
  height: 40px;
}

.column {
  width: 8px;
  background-color: rgba(255, 255, 255, 0.9);
  margin: 0 2px;
  border-radius: 2px 2px 0 0;
  position: relative;
}

.column:nth-child(1) { height: 35px; }
.column:nth-child(2) { height: 40px; }
.column:nth-child(3) { height: 35px; }

.column::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background-color: rgba(255, 255, 255, 0.9);
  border-radius: 2px 2px 0 0;
}

.column::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: -2px;
  right: -2px;
  height: 3px;
  background-color: rgba(255, 255, 255, 0.9);
}

.academy-base {
  height: 4px;
  background-color: rgba(255, 255, 255, 0.9);
  width: 42px;
  border-radius: 2px;
}
</style>
</head>
<body>
<div id="app">
<header>
<div class="header-content">
<div class="greek-academy">
<div class="column"></div>
<div class="column"></div>
<div class="column"></div>
<div class="academy-base"></div>
</div>
<h1>DIPLOMACY MUN Committee Timer</h1>
</div>
<div class="auth-status">
<span id="auth-username">Not logged in</span>
<button id="auth-button" class="button secondary">Login with GitHub</button>
</div>
</header>

<div class="tabs">
<button class="tab active" data-tab="main">Main Dashboard</button>
<button class="tab" data-tab="speaking-list">Speaking List</button>
<button class="tab" data-tab="messaging">Messaging</button>
</div>
<!-- Main Dashboard Tab -->
<div id="main-tab" class="tab-content active">
<div class="top-controls">
<div class="committee-selector">
<label for="committee-select">Committee:</label>
<select id="committee-select">
<option value="UNSC">UNSC</option>
<option value="UNODC">UNODC</option>
<option value="UNGA">UNGA</option>
<option value="UNHRC">UNHRC</option>
<option value="ECOSOC">ECOSOC</option>
<option value="WHO">WHO</option>
</select>
</div>
<div class="control-buttons">
<button id="export-button" class="button warning">Export Data</button>
<button id="role-call-button" class="button">Role Call</button>
<button id="lock-countries-button" class="button secondary">Lock Countries</button>
</div>
</div>

<!-- In the main-tab div, replace the existing columns div with this structure -->
<div class="columns">
  <!-- First row - Countries and Timers -->
  <div class="columns-row">
    <div class="column">
      <!-- Country List Card (keep this as is) -->
      <div class="card">
        <div class="card-header">Countries</div>
        <div class="card-body">
          <div class="list-container">
            <ul id="country-list" class="list"></ul>
          </div>
          <button id="add-to-list-button" class="button primary" style="width: 100%; margin-top: 10px;">Add to Speaking List</button>
        </div>
      </div>
    </div>

    <div class="column">
      <!-- Timers Section (keep this as is) -->
      <div class="card">
        <!-- Timer content as is -->
      </div>
      <!-- Fun Mode Button (keep this as is) -->
      <button id="fun-mode-button" class="button accent" style="width: 100%; margin-top: 10px;">Fun Committee Mode</button>
    </div>
  </div>

  <!-- Second row - Notes, Frequency, and Performance Data -->
  <div class="columns-row">
    <div class="column">
      <!-- Notes Section (moved here) -->
      <div class="card">
        <div class="card-header">Notes</div>
        <div class="card-body">
          <textarea id="notes-area" class="notes-area" placeholder="Enter notes here..."></textarea>
          <div class="note-buttons">
            <button class="button success" data-note="Good Speech">Good Speech</button>
            <button class="button danger" data-note="Bad Speech">Bad Speech</button>
            <button class="button primary" data-note="Good Diplomacy">Good Diplomacy</button>
            <button class="button warning" data-note="Bad Diplomacy">Bad Diplomacy</button>
          </div>
        </div>
      </div>
    </div>

    <div class="column">
      <!-- Frequency List Card (keep this as is) -->
      <div class="card">
        <div class="card-header">Speaker Frequency</div>
        <div class="card-body">
          <div class="list-container">
            <ul id="frequency-list" class="list"></ul>
          </div>
        </div>
      </div>
    </div>

    <div class="column">
      <!-- Performance List Card (keep this as is) -->
      <div class="card">
        <div class="card-header">
          <span>Speaker Performance</span>
          <button id="toggle-performance-button" class="button secondary" style="padding: 2px 8px; font-size: 0.8rem;">Show</button>
        </div>
        <div class="card-body">
          <div id="performance-list-container" class="list-container" style="display: none;">
            <ul id="performance-list" class="list"></ul>
          </div>
          <div class="performance-legend">
            <div><span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #4CAF50; margin-right: 5px;"></span> High Performance (>75%)</div>
            <div><span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #FFA726; margin-right: 5px;"></span> Medium Performance (50-75%)</div>
            <div><span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #F44336; margin-right: 5px;"></span> Low Performance (<50%)</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="timer-cards">
<div class="timer-card">
<div class="timer-title">Session</div>
<div class="timer-display" id="session-timer">00:00</div>
<div class="timer-settings">
<input type="number" class="timer-duration" min="1" value="10" data-timer="session"> min
<button class="timer-set-button" data-timer="session">Set</button>
</div>
<div class="timer-controls">
<button class="timer-button" data-timer="session" data-action="start">Start</button>
<button class="timer-button" data-timer="session" data-action="stop">Stop</button>
<button class="timer-button" data-timer="session" data-action="reset">Reset</button>
</div>
</div>
<div class="timer-card">
<div class="timer-title">Caucus</div>
<div class="timer-display" id="caucus-timer">00:00</div>
<div class="timer-settings">
<input type="number" class="timer-duration" min="1" value="5" data-timer="caucus"> min
<button class="timer-set-button" data-timer="caucus">Set</button>
</div>
<div class="timer-controls">
<button class="timer-button" data-timer="caucus" data-action="start">Start</button>
<button class="timer-button" data-timer="caucus" data-action="stop">Stop</button>
<button class="timer-button" data-timer="caucus" data-action="reset">Reset</button>
</div>
</div>
<div class="timer-card">
<div class="timer-title">Speech</div>
<div class="timer-display" id="speech-timer">00:00</div>
<div class="timer-settings">
<input type="number" class="timer-duration" min="1" value="1" data-timer="speech"> min
<button class="timer-set-button" data-timer="speech">Set</button>
</div>
<div class="timer-controls">
<button class="timer-button" data-timer="speech" data-action="start">Start</button>
<button class="timer-button" data-timer="speech" data-action="stop">Stop</button>
<button class="timer-button" data-timer="speech" data-action="reset">Reset</button>
</div>
</div>
</div>
<button id="rearrange-timers-button" class="button secondary" style="width: 100%;">Rearrange Timers</button>
</div>
</div>

<!-- Fun Mode Button -->
<button id="fun-mode-button" class="button accent" style="width: 100%; margin-top: 10px;">Fun Committee Mode</button>
</div>
</div>
<!-- Second row - Notes and Performance Data -->
<div class="columns-row">
<div class="column">
<!-- Notes Section -->
<div class="card">
<div class="card-header">Notes</div>
<div class="card-body">
<textarea id="notes-area" class="notes-area" placeholder="Enter notes here..."></textarea>
<div class="note-buttons">
<button class="button success" data-note="Good Speech">Good Speech</button>
<button class="button danger" data-note="Bad Speech">Bad Speech</button>
<button class="button primary" data-note="Good Diplomacy">Good Diplomacy</button>
<button class="button warning" data-note="Bad Diplomacy">Bad Diplomacy</button>
</div>
</div>
</div>
</div>

<div class="column">
<!-- Frequency List Card -->
<div class="card">
<div class="card-header">Speaker Frequency</div>
<div class="card-body">
<div class="list-container">
<ul id="frequency-list" class="list"></ul>
</div>
</div>
</div>
</div>

<div class="column">
<!-- Performance List Card -->
<div class="card">
<div class="card-header">
<span>Speaker Performance</span>
<button id="toggle-performance-button" class="button secondary" style="padding: 2px 8px; font-size: 0.8rem;">Show</button>
</div>
<div class="card-body">
<div id="performance-list-container" class="list-container" style="display: none;">
<ul id="performance-list" class="list"></ul>
</div>
<div class="performance-legend">
<div><span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #4CAF50; margin-right: 5px;"></span> High Performance (>75%)</div>
<div><span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #FFA726; margin-right: 5px;"></span> Medium Performance (50-75%)</div>
<div><span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #F44336; margin-right: 5px;"></span> Low Performance (<50%)</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Speaking List Tab -->
<div id="speaking-list-tab" class="tab-content">
<div class="current-speaker">
<div class="current-speaker-label">Current Speaker</div>
<div class="current-speaker-name" id="current-speaker-display">None</div>
<div>
<button id="next-speaker-button" class="button success">Next Speaker</button>
<button id="skip-speaker-button" class="button danger">Skip Speaker</button>
</div>
</div>

<div class="card">
<div class="card-header">Speaking List</div>
<div class="card-body">
<div class="list-container" style="height: 400px;">
<ul id="speaking-list" class="list"></ul>
</div>
<div class="list-controls">
<button id="move-up-button" class="button primary">Move Up</button>
<button id="move-down-button" class="button primary">Move Down</button>
<button id="remove-button" class="button danger">Remove</button>
<button id="clear-list-button" class="button secondary">Clear List</button>
</div>
</div>
</div>
</div>
<!-- Messaging Tab -->
<div id="messaging-tab" class="tab-content">
<!-- Authentication Required Panel -->
<div id="auth-required-panel">
<div class="card">
<div class="card-body" style="text-align: center; padding: 40px 20px;">
<h2>GitHub Authentication Required</h2>
<p>You need to authenticate with GitHub to access the messaging feature.</p>
<button id="auth-messaging-button" class="button primary">Authenticate with GitHub</button>
</div>
</div>
</div>

<!-- Messaging Interface (hidden initially) -->
<div id="messaging-interface" style="display: none;">
<div class="messaging-container">
<div class="delegates-list">
<div class="card" style="height: 100%;">
<div class="card-header">Delegates</div>
<div class="card-body" style="height: calc(100% - 50px); display: flex; flex-direction: column;">
<div class="list-container" style="flex: 1;">
<ul id="conversation-list" class="list"></ul>
</div>
<button id="new-message-button" class="button success" style="margin-top: 10px;">New Message</button>
</div>
</div>
</div>

<div class="messages-container">
<div class="card" style="flex: 1; margin-bottom: 10px;">
<div class="card-header">Messages</div>
<div class="card-body" style="height: calc(100% - 50px); overflow-y: auto;">
<div id="message-display"></div>
</div>
</div>

<div class="message-compose">
<textarea id="message-input" class="message-input" placeholder="Type your message here..."></textarea>
<div style="text-align: right;">
<button id="send-message-button" class="button primary">Send Message</button>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Role Call Modal -->
<div id="role-call-modal" class="role-call-container">
<div class="role-call-modal">
<div class="role-call-header">
<h2 id="role-call-title">Role Call</h2>
<div>
<label for="role-call-date">Date:</label>
<input type="text" id="role-call-date" placeholder="YYYY-MM-DD">
<button id="add-date-button" class="button primary">Add Date</button>
<button id="close-role-call-button" class="button">Close</button>
</div>
</div>
<div class="role-call-body">
<table id="role-call-table" class="role-call-table">
<thead>
<tr>
<th>Country</th>
<!-- Dates will be inserted dynamically -->
</tr>
</thead>
<tbody>
<!-- Countries and attendance will be inserted dynamically -->
</tbody>
</table>
<div style="text-align: right; margin-top: 15px;">
<button id="save-role-call-button" class="button success">Save Role Call</button>
</div>
</div>
</div>
</div>

<!-- New Message Dialog -->
<div id="new-message-dialog" class="dialog">
<div class="dialog-content">
<h3 class="dialog-title">New Message</h3>
<div>
<label for="recipient-select">To:</label>
<select id="recipient-select" style="width: 100%; margin-bottom: 15px;"></select>
</div>
<div>
<label for="new-message-text">Message:</label>
<textarea id="new-message-text" class="message-input"></textarea>
</div>
<div class="dialog-buttons">
<button id="cancel-message-button" class="button secondary">Cancel</button>
<button id="send-new-message-button" class="button primary">Send</button>
</div>
</div>
</div>
<!-- Enhanced Fun Mode Container -->
<div id="fun-mode-container" style="display: none;">
    <div class="fun-mode">
        <div class="fun-mode-header">DIPLOMACY Fun Committee Mode</div>
        
        <div class="fun-timer" id="fun-timer">00:00</div>
        
        <div class="fun-mode-actions">
            <button class="fun-mode-button" data-action="start-fun">Start</button>
            <button class="fun-mode-button" data-action="stop-fun">Pause</button>
            <button class="fun-mode-button" data-action="reset-fun">Reset</button>
        </div>
        
        <h3 style="margin-top: 30px;">Select an Activity</h3>
        <div style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 15px;">
            Click on an activity to select it, then use the voting buttons to determine the most popular choice
        </div>
        
        <div class="game-options">
            <div class="game-option">
                <span>UN Charades - Votes: <span class="vote-count">0</span></span>
                <button class="button primary vote-button">Vote</button>
            </div>
            
            <div class="game-option">
                <span>Diplomatic Trivia - Votes: <span class="vote-count">0</span></span>
                <button class="button primary vote-button">Vote</button>
            </div>
            
            <div class="game-option">
                <span>Resolution Writing Race - Votes: <span class="vote-count">0</span></span>
                <button class="button primary vote-button">Vote</button>
            </div>
            
            <div class="game-option">
                <span>Crisis Simulation - Votes: <span class="vote-count">0</span></span>
                <button class="button primary vote-button">Vote</button>
            </div>
        </div>
        
        <button id="exit-fun-mode-button" class="button danger">Exit Fun Mode</button>
    </div>
</div>
</div>

<style>
/* Header with Greek columns */
header {
background-color: var(--primary);
color: var(--text-on-primary);
padding: 15px var(--padding);
display: flex;
justify-content: space-between;
align-items: center;
border-radius: 0 0 var(--corner-radius) var(--corner-radius);
position: relative;
overflow: hidden;
}

/* Greek Academy styling */
.header-content {
display: flex;
align-items: center;
z-index: 2;
}

.greek-academy {
margin-right: 15px;
display: flex;
align-items: flex-end;
height: 40px;
}

.column {
width: 8px;
background-color: rgba(255, 255, 255, 0.9);
margin: 0 2px;
border-radius: 2px 2px 0 0;
position: relative;
}

.column:nth-child(1) { height: 35px; }
.column:nth-child(2) { height: 40px; }
.column:nth-child(3) { height: 35px; }

.column::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 5px;
background-color: rgba(255, 255, 255, 0.9);
border-radius: 2px 2px 0 0;
}

.column::after {
content: '';
position: absolute;
bottom: 0;
left: -2px;
right: -2px;
height: 3px;
background-color: rgba(255, 255, 255, 0.9);
}

.academy-base {
height: 4px;
background-color: rgba(255, 255, 255, 0.9);
width: 42px;
border-radius: 2px;
}

h1 {
margin: 0;
font-size: 1.5rem;
}

.tabs {
display: flex;
background-color: var(--bg-secondary);
padding: 0 var(--padding);
margin-top: 10px;
border-radius: var(--corner-radius) var(--corner-radius) 0 0;
}

.tab {
padding: 12px 16px;
cursor: pointer;
background-color: var(--bg-secondary);
color: var(--text-secondary);
border: none;
font-family: var(--font-family);
font-size: 1rem;
transition: background-color 0.2s, color 0.2s;
border-radius: var(--corner-radius) var(--corner-radius) 0 0;
}

.tab.active {
background-color: var(--primary);
color: var(--text-on-primary);
}

.tab:hover:not(.active) {
background-color: var(--highlight);
}

.tab-content {
display: none;
padding: var(--padding);
background-color: var(--bg-elevated);
border-radius: 0 0 var(--corner-radius) var(--corner-radius);
box-shadow: 0 2px 4px rgba(0,0,0,0.1);
margin-bottom: 20px;
}

.tab-content.active {
display: block;
}
</style>
<style>
.top-controls {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
flex-wrap: wrap;
}

.committee-selector {
display: flex;
align-items: center;
}

.committee-selector label {
margin-right: 8px;
}

select {
padding: 8px 12px;
border: 1px solid var(--border);
border-radius: var(--corner-radius);
background-color: var(--bg-elevated);
font-family: var(--font-family);
color: var(--text-primary);
}

.button {
background-color: var(--primary);
color: var(--text-on-primary);
border: none;
padding: 8px 16px;
border-radius: var(--corner-radius);
cursor: pointer;
font-family: var(--font-family);
font-size: 0.9rem;
transition: background-color 0.2s;
margin: 0 5px;
}

.button:hover {
filter: brightness(1.1);
}

.button.success { background-color: var(--success); }
.button.warning { background-color: var(--warning); }
.button.danger { background-color: var(--danger); }
.button.secondary { background-color: var(--secondary); }
.button.accent { background-color: var(--accent); }

/* Modified columns layout - to move notes and frequency to bottom *//* Modified columns layout - to move notes and frequency to bottom */
.columns {
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin-top: 15px;
}

.columns-row {
  display: flex;
  gap: 20px;
}

.column {
  flex: 1;
}

@media (max-width: 768px) {
  .columns-row {
    flex-direction: column;
  }
}

.card {
background-color: var(--bg-elevated);
border-radius: var(--corner-radius);
box-shadow: 0 2px 6px rgba(0,0,0,0.1);
margin-bottom: 15px;
overflow: hidden;
}

.card-header {
background-color: var(--primary);
color: var(--text-on-primary);
padding: 10px 15px;
font-weight: bold;
display: flex;
justify-content: space-between;
align-items: center;
}

.card-body {
padding: 15px;
}

.list-container {
height: 300px;
overflow-y: auto;
border: 1px solid var(--border);
border-radius: var(--corner-radius);
background-color: var(--bg-elevated);
}

.list {
list-style: none;
padding: 0;
margin: 0;
}

.list-item {
padding: 8px 15px;
border-bottom: 1px solid var(--border);
cursor: pointer;
}

.list-item:hover {
background-color: var(--highlight);
}

.list-item.selected {
background-color: var(--primary);
color: var(--text-on-primary);
}

.timer-cards {
display: flex;
gap: 15px;
margin-bottom: 15px;
}

.timer-card {
flex: 1;
background-color: var(--timer-green);
color: var(--text-on-primary);
border-radius: var(--corner-radius);
padding: 15px;
text-align: center;
box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}

.timer-card:nth-child(2) {
background-color: var(--timer-blue);
}

.timer-card:nth-child(3) {
background-color: var(--timer-orange);
}

.timer-title {
font-weight: bold;
margin-bottom: 8px;
}

.timer-display {
font-size: 2.5rem;
font-weight: bold;
margin: 10px 0 15px;
}

.timer-controls {
display: flex;
justify-content: space-around;
}

.timer-button {
background-color: rgba(255,255,255,0.2);
color: white;
border: none;
padding: 6px 10px;
border-radius: var(--corner-radius);
cursor: pointer;
font-family: var(--font-family);
transition: background-color 0.2s;
}

.timer-button:hover {
background-color: rgba(255,255,255,0.3);
}

.timer-settings {
margin-bottom: 10px;
display: flex;
justify-content: center;
align-items: center;
gap: 5px;
}

.timer-duration {
width: 50px;
padding: 2px 5px;
border: 1px solid rgba(255,255,255,0.3);
background-color: rgba(255,255,255,0.1);
color: white;
border-radius: var(--corner-radius);
text-align: center;
}

.timer-set-button {
background-color: rgba(255,255,255,0.2);
color: white;
border: none;
padding: 2px 8px;
border-radius: var(--corner-radius);
cursor: pointer;
transition: background-color 0.2s;
}

.timer-set-button:hover {
background-color: rgba(255,255,255,0.3);
}

.notes-area {
width: 100%;
height: 150px;
padding: 10px;
border: 1px solid var(--border);
border-radius: var(--corner-radius);
font-family: var(--font-family);
resize: vertical;
margin-bottom: 10px;
}

.note-buttons {
display: flex;
flex-wrap: wrap;
gap: 10px;
}

/* Current speaker display */
.current-speaker {
text-align: center;
padding: 20px;
margin-bottom: 20px;
}

.current-speaker-label {
font-size: 1.2rem;
color: var(--primary);
font-weight: bold;
margin-bottom: 5px;
}

.current-speaker-name {
font-size: 2rem;
margin: 10px 0 20px;
}

/* Speaker list controls */
.list-controls {
display: flex;
justify-content: space-between;
margin-top: 10px;
}

/* For frequency list coloring */
.frequency-indicator {
display: inline-block;
width: 10px;
height: 10px;
border-radius: 50%;
margin-right: 8px;
}

/* Messaging layout */
.messaging-container {
display: flex;
height: 500px;
gap: 15px;
}

.delegates-list {
flex: 1;
max-width: 300px;
}

.messages-container {
flex: 2;
display: flex;
flex-direction: column;
}

.messages-list {
flex: 1;
overflow-y: auto;
margin-bottom: 15px;
}

.message-compose {
background-color: var(--bg-elevated);
padding: 15px;
border-radius: var(--corner-radius);
border: 1px solid var(--border);
}

.message-input {
width: 100%;
min-height: 80px;
padding: 10px;
border: 1px solid var(--border);
border-radius: var(--corner-radius);
font-family: var(--font-family);
margin-bottom: 10px;
resize: vertical;
}
</style>
<style>
/* Role call styles */
.role-call-container {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: rgba(0,0,0,0.5);
display: none;
justify-content: center;
align-items: center;
z-index: 1000;
}

.role-call-modal {
background-color: var(--bg-elevated);
width: 80%;
max-width: 1000px;
max-height: 80vh;
border-radius: var(--corner-radius);
overflow-y: auto;
}

.role-call-header {
background-color: var(--primary);
color: var(--text-on-primary);
padding: 15px;
display: flex;
justify-content: space-between;
align-items: center;
}

.role-call-body {
padding: 15px;
}

.role-call-table {
width: 100%;
border-collapse: collapse;
}

.role-call-table th, .role-call-table td {
padding: 10px;
text-align: left;
border-bottom: 1px solid var(--border);
}

.role-call-table th {
background-color: var(--bg-secondary);
font-weight: bold;
}

.role-call-table tr:nth-child(even) {
background-color: var(--bg-secondary);
}

.dialog {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: rgba(0,0,0,0.5);
display: none;
justify-content: center;
align-items: center;
z-index: 1000;
}

.dialog-content {
background-color: var(--bg-elevated);
padding: 20px;
border-radius: var(--corner-radius);
min-width: 300px;
max-width: 500px;
}

.dialog-title {
margin-top: 0;
color: var(--primary);
}

.dialog-buttons {
display: flex;
justify-content: flex-end;
margin-top: 20px;
gap: 10px;
}

.tab.disabled {
opacity: 0.5;
cursor: not-allowed;
}

/* Performance list specific styles */
.performance-legend {
display: flex;
flex-direction: column;
gap: 5px;
margin-top: 10px;
font-size: 0.8rem;
}

/* Timer relationship indicator styles */
.timer-relationship {
font-size: 12px;
margin-top: 5px;
color: rgba(255,255,255,0.8);
}

/* Timer suggestions box */
#timer-suggestions {
background-color: rgba(255,255,255,0.9);
border: 1px solid var(--border);
border-radius: var(--corner-radius);
padding: 10px;
margin-top: 15px;
font-size: 14px;
}

@media (max-width: 768px) {
.columns-row {
flex-direction: column;
}

.timer-cards {
flex-direction: column;
}

.messaging-container {
flex-direction: column;
}

.delegates-list {
max-width: 100%;
}
}

/* Fun mode styles - Enhanced */
.fun-mode {
background: linear-gradient(135deg, #FF5BFF 0%, #6A0DAD 100%);
color: white;
text-align: center;
padding: 30px 20px;
border-radius: var(--corner-radius);
box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.fun-mode-header {
font-size: 2.5rem;
margin-bottom: 20px;
text-shadow: 0 2px 4px rgba(0,0,0,0.3);
font-weight: bold;
}

.fun-timer {
font-size: 5rem;
margin: 20px 0;
font-weight: bold;
text-shadow: 0 2px 8px rgba(0,0,0,0.5);
background-color: rgba(0,0,0,0.2);
border-radius: 15px;
padding: 10px;
display: inline-block;
min-width: 200px;
}

.game-options {
margin: 30px 0;
max-width: 600px;
margin-left: auto;
margin-right: auto;
}

.game-option {
background-color: rgba(255,255,255,0.15);
border: 2px solid rgba(255,255,255,0.3);
color: white;
margin: 15px auto;
padding: 15px;
border-radius: var(--corner-radius);
display: flex;
justify-content: space-between;
align-items: center;
transition: all 0.3s ease;
}

.game-option:hover {
background-color: rgba(255,255,255,0.25);
transform: translateY(-2px);
box-shadow: 0 5px 10px rgba(0,0,0,0.2);
}

.game-option.selected {
background-color: rgba(255,255,255,0.4);
border-color: white;
}

.vote-button {
background-color: #6A0DAD;
border: 2px solid white;
}

.vote-button:hover {
background-color: #8A2BE2;
}

/* Fun mode animations */
@keyframes pulse {
0% { transform: scale(1); }
50% { transform: scale(1.05); }
100% { transform: scale(1); }
}

.fun-timer.warning {
color: #FFEB3B;
animation: pulse 1s infinite;
}

.fun-timer.danger {
color: #FF5252;
animation: pulse 0.5s infinite;
}

.fun-mode-actions {
display: flex;
justify-content: center;
gap: 10px;
margin: 20px 0;
}

.fun-mode-button {
background-color: #6A0DAD;
color: white;
border: 2px solid white;
padding: 10px 20px;
border-radius: var(--corner-radius);
font-weight: bold;
font-size: 1rem;
cursor: pointer;
transition: all 0.2s ease;
}

.fun-mode-button:hover {
background-color: #8A2BE2;
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

#exit-fun-mode-button {
background-color: #FF5252;
margin-top: 20px;
padding: 10px 25px;
font-size: 1.1rem;
transition: all 0.3s ease;
}

#exit-fun-mode-button:hover {
background-color: #FF7675;
}

/* Winner display for fun mode */
.winner-display {
background-color: rgba(255,255,255,0.2);
border-radius: var(--corner-radius);
padding: 15px;
margin: 20px auto;
max-width: 500px;
}

.winner-title {
font-size: 1.5rem;
margin-bottom: 10px;
font-weight: bold;
}

.winner-name {
font-size: 2rem;
color: #FFEB3B;
text-shadow: 0 2px 4px rgba(0,0,0,0.3);
margin: 10px 0;
}

.confetti {
position: absolute;
width: 10px;
height: 10px;
background-color: #f0f;
animation: confetti-fall 5s ease-in-out forwards;
opacity: 0.8;
}

@keyframes confetti-fall {
0% {
transform: translateY(-100vh) rotate(0deg);
opacity: 1;
}
100% {
transform: translateY(100vh) rotate(720deg);
opacity: 0;
}
}
</style>
<script>
// Define the state object to store application data
const state = {
    selectedCommittee: 'UNSC',
    speakerQueue: [],
    currentSpeaker: null,
    delegateData: {},
    attendanceData: {},
    attendanceDates: [],
    isCountryListLocked: false,
    showPerformanceList: false,
    
    // Timer states
    timerDurations: {
        session: 10 * 60, // 10 minutes in seconds
        caucus: 5 * 60,   // 5 minutes in seconds
        speech: 1 * 60,   // 1 minute in seconds
        fun: 5 * 60       // 5 minutes in seconds
    },
    timerElapsed: {
        session: 10 * 60,
        caucus: 5 * 60,
        speech: 1 * 60,
        fun: 5 * 60
    },
    timerRunning: {
        session: false,
        caucus: false,
        speech: false,
        fun: false
    },
    timerIntervals: {
        session: null,
        caucus: null,
        speech: null,
        fun: null
    },
    timerColors: [
        'var(--timer-green)',
        'var(--timer-blue)',
        'var(--timer-orange)'
    ],
    
    // Authentication status
    isAuthenticated: false,
    authUser: null,
    requiredAuthFeatures: ['messaging', 'performance'],
    
    // Fun mode state initialized in initializeFunMode function
};

// Define the committee countries
const committeeCountries = {
    'UNSC': [
        'United States', 'United Kingdom', 'France', 'Russia', 'China',
        'Albania', 'Brazil', 'Gabon', 'Ghana', 'India', 'Ireland', 'Kenya',
        'Mexico', 'Norway', 'United Arab Emirates'
    ],
    'UNODC': [
        'United States', 'Russia', 'China', 'United Kingdom', 'France',
        'Germany', 'Japan', 'Canada', 'Italy', 'Brazil', 'Mexico', 'Colombia',
        'Nigeria', 'South Africa', 'India', 'Pakistan', 'Thailand', 'Australia'
    ],
    'UNGA': [
        'United States', 'Russia', 'China', 'United Kingdom', 'France',
        'Germany', 'Japan', 'Canada', 'India', 'Brazil', 'South Africa',
        'Australia', 'Mexico', 'Indonesia', 'Saudi Arabia', 'Nigeria', 'Egypt',
        'Pakistan', 'Turkey', 'Argentina'
    ],
    'UNHRC': [
        'Argentina', 'Benin', 'Cameroon', 'China', 'Cuba', 'Eritrea', 
        'Finland', 'France', 'Gambia', 'Germany', 'Honduras', 'India', 
        'Kazakhstan', 'Libya', 'Luxembourg', 'Malaysia', 'Montenegro', 
        'Pakistan', 'Qatar', 'Somalia', 'United Arab Emirates', 'United States', 
        'Uzbekistan'
    ],
    'ECOSOC': [
        'United States', 'United Kingdom', 'France', 'Germany', 'Japan',
        'China', 'Russia', 'Canada', 'India', 'Brazil', 'Mexico', 'South Africa',
        'Nigeria', 'Egypt', 'Pakistan', 'Bangladesh', 'Indonesia', 'Turkey',
        'Saudi Arabia', 'Australia'
    ],
    'WHO': [
        'United States', 'United Kingdom', 'France', 'Germany', 'Japan',
        'China', 'Russia', 'India', 'Brazil', 'South Africa', 'Nigeria',
        'Egypt', 'Australia', 'Canada', 'Mexico', 'Argentina', 'South Korea',
        'Italy', 'Spain', 'Switzerland'
    ]
};

// Function to update timer relationship indicators
function updateTimerRelationships() {
    const sessionMinutes = state.timerDurations.session / 60;
    const caucusMinutes = state.timerDurations.caucus / 60;
    const speechMinutes = state.timerDurations.speech / 60;

    // Calculate if session divides evenly into caucuses
    const caucusRemainder = sessionMinutes % caucusMinutes;
    
    // Calculate if speech divides evenly into session
    const speechRemainder = sessionMinutes % speechMinutes;

    // Create relationship indicators
    const sessionCard = document.querySelector('.timer-card:nth-child(1)');
    const caucusCard = document.querySelector('.timer-card:nth-child(2)');
    const speechCard = document.querySelector('.timer-card:nth-child(3)');

    // Clear previous indicators
    document.querySelectorAll('.timer-relationship').forEach(el => el.remove());

    // Session to caucus relationship
    let sessionToCaucus = document.createElement('div');
    sessionToCaucus.className = 'timer-relationship';
    sessionToCaucus.textContent = `${Math.floor(sessionMinutes / caucusMinutes)} caucuses + ${caucusRemainder} minutes`;
    
    if (caucusRemainder === 0) {
        sessionToCaucus.style.color = 'rgba(255,255,255,1)';
    }
    
    sessionCard.appendChild(sessionToCaucus);

    // Session to speech relationship
    let sessionToSpeech = document.createElement('div');
    sessionToSpeech.className = 'timer-relationship';
    sessionToSpeech.textContent = `${Math.floor(sessionMinutes / speechMinutes)} speeches + ${speechRemainder} minutes`;
    
    if (speechRemainder === 0) {
        sessionToSpeech.style.color = 'rgba(255,255,255,1)';
    }
    
    sessionCard.appendChild(sessionToSpeech);

    // Caucus to speech relationship
    let caucusToSpeech = document.createElement('div');
    caucusToSpeech.className = 'timer-relationship';
    const speechesPerCaucus = Math.floor(caucusMinutes / speechMinutes);
    const speechesRemainder = caucusMinutes % speechMinutes;
    
    caucusToSpeech.textContent = `${speechesPerCaucus} speeches + ${speechesRemainder} minutes`;
    
    if (speechesRemainder === 0) {
        caucusToSpeech.style.color = 'rgba(255,255,255,1)';
    }
    
    caucusCard.appendChild(caucusToSpeech);
}

// Function to validate timer settings and suggest improvements
function validateTimerSettings() {
    const sessionMinutes = state.timerDurations.session / 60;
    const caucusMinutes = state.timerDurations.caucus / 60;
    const speechMinutes = state.timerDurations.speech / 60;

    const caucusRemainder = sessionMinutes % caucusMinutes;
    const speechRemainder = sessionMinutes % speechMinutes;

    const suggestions = [];

    if (caucusRemainder > 0) {
        const suggestedCaucus = sessionMinutes / Math.round(sessionMinutes / caucusMinutes);
        suggestions.push({
            timer: 'caucus',
            currentValue: caucusMinutes,
            suggestedValue: Math.round(suggestedCaucus * 10) / 10,
            reason: 'For even division of session into caucuses'
        });
    }

    if (speechRemainder > 0) {
        const suggestedSpeech = sessionMinutes / Math.round(sessionMinutes / speechMinutes);
        suggestions.push({
            timer: 'speech',
            currentValue: speechMinutes,
            suggestedValue: Math.round(suggestedSpeech * 10) / 10,
            reason: 'For even division of session into speeches'
        });
    }

    return suggestions;
}

// Function to display suggestions in a user-friendly way
function showTimerSuggestions() {
    const suggestions = validateTimerSettings();

    if (suggestions.length === 0) {
        // All timers divide evenly, no suggestions needed
        const existingSuggestions = document.getElementById('timer-suggestions');
        if (existingSuggestions) {
            existingSuggestions.style.display = 'none';
        }
        return;
    }

    // Create or update a suggestions box
    let suggestionsBox = document.getElementById('timer-suggestions');

    if (!suggestionsBox) {
        suggestionsBox = document.createElement('div');
        suggestionsBox.id = 'timer-suggestions';

        // Add it after the timer cards
        const timerCards = document.querySelector('.timer-cards');
        if (timerCards) {
            timerCards.insertAdjacentElement('afterend', suggestionsBox);
        }
    } else {
        suggestionsBox.style.display = 'block';
    }

    // Clear previous content
    suggestionsBox.innerHTML = '<h4 style="margin-top: 0;">Timer Relationship Suggestions</h4>';

    // Add suggestions
    const list = document.createElement('ul');
    list.style.paddingLeft = '20px';

    suggestions.forEach(suggestion => {
        const item = document.createElement('li');
        item.style.marginBottom = '5px';

        const applyButton = document.createElement('button');
        applyButton.textContent = 'Apply';
        applyButton.className = 'button primary';
        applyButton.style.fontSize = '12px';
        applyButton.style.padding = '2px 8px';
        applyButton.style.marginLeft = '10px';

        applyButton.addEventListener('click', function() {
            // Update the timer duration input and trigger the Set button
            const input = document.querySelector(`.timer-duration[data-timer="${suggestion.timer}"]`);
            const setButton = document.querySelector(`.timer-set-button[data-timer="${suggestion.timer}"]`);

            if (input && setButton) {
                input.value = suggestion.suggestedValue;
                setButton.click(); // Trigger the Set button click event
            }
        });

        item.innerHTML = `Change <strong>${suggestion.timer}</strong> timer from ${suggestion.currentValue} to <strong>${suggestion.suggestedValue}</strong> minutes ${suggestion.reason}.`;
        item.appendChild(applyButton);

        list.appendChild(item);
    });

    suggestionsBox.appendChild(list);
}

function formatTime(timeInSeconds) {
    const minutes = Math.floor(timeInSeconds / 60).toString().padStart(2, '0');
    const seconds = (timeInSeconds % 60).toString().padStart(2, '0');
    return `${minutes}:${seconds}`;
}

function updateTimerDisplay(timerType) {
    const display = document.getElementById(`${timerType.toLowerCase()}-timer`);
    if (display) {
        display.textContent = formatTime(state.timerElapsed[timerType.toLowerCase()]);
        
        // Special handling for fun timer
        if (timerType.toLowerCase() === 'fun') {
            // Remove existing classes
            display.classList.remove('warning', 'danger');
            
            // Add warning/danger classes based on time remaining
            const totalDuration = state.timerDurations.fun;
            const percentRemaining = (state.timerElapsed.fun / totalDuration) * 100;
            
            if (percentRemaining <= 10) {
                display.classList.add('danger');
            } else if (percentRemaining <= 25) {
                display.classList.add('warning');
            }
            
            // If timer reaches zero, show winner
            if (state.timerElapsed.fun === 0 && state.funMode?.activeGame) {
                showGameWinner();
            }
        }
    }
}
</script>
<script>
function startTimer(timerType) {
    const lowerType = timerType.toLowerCase();

    // Stop any running timer first to ensure clean state
    stopTimer(timerType);

    // Set running state
    state.timerRunning[lowerType] = true;

    // Create new interval for countdown
    state.timerIntervals[lowerType] = setInterval(() => {
        // Reduce timer by 1 second
        if (state.timerElapsed[lowerType] > 0) {
            state.timerElapsed[lowerType]--;
            updateTimerDisplay(timerType);
        } else {
            // Timer reached zero
            stopTimer(timerType);
            // You could add an alert or sound here
            console.log(`${timerType} timer finished!`);
            
            // For fun timer, display winner
            if (lowerType === 'fun' && state.funMode?.activeGame) {
                showGameWinner();
            }
        }
    }, 1000);

    console.log(`Started ${timerType} timer countdown from ${state.timerElapsed[lowerType]} seconds`);
}

function stopTimer(timerType) {
    const lowerType = timerType.toLowerCase();

    // Always clear interval, even if we think it's not running
    if (state.timerIntervals[lowerType]) {
        clearInterval(state.timerIntervals[lowerType]);
        state.timerIntervals[lowerType] = null;
    }

    state.timerRunning[lowerType] = false;
    console.log(`Stopped ${timerType} timer`);
}

// Use the stored duration
function resetTimer(timerType) {
    const lowerType = timerType.toLowerCase();
    stopTimer(timerType);
    state.timerElapsed[lowerType] = state.timerDurations[lowerType]; // Use the stored duration
    updateTimerDisplay(timerType);
    console.log(`Reset ${timerType} timer to ${state.timerDurations[lowerType]} seconds`);
}

// Function to set timer duration
function setTimerDuration(timerType, minutes) {
    const seconds = minutes * 60;
    const lowerType = timerType.toLowerCase();

    state.timerDurations[lowerType] = seconds;

    // If timer is not running, update the elapsed time too
    if (!state.timerRunning[lowerType]) {
        state.timerElapsed[lowerType] = seconds;
        updateTimerDisplay(timerType);
    }

    console.log(`Set ${timerType} timer duration to ${minutes} minutes (${seconds} seconds)`);

    // Update timer relationships
    updateTimerRelationships();

    // Show suggestions if needed
    showTimerSuggestions();
}

// Function to populate country list
function populateCountryList(committee) {
    const countryList = document.getElementById('country-list');
    if (!countryList) return;

    countryList.innerHTML = '';

    if (!committeeCountries[committee]) {
        console.error(`Committee ${committee} not found in committeeCountries`);
        return;
    }

    committeeCountries[committee].forEach(country => {
        const li = document.createElement('li');
        li.textContent = country;
        li.className = 'list-item';
        li.addEventListener('click', function() {
            document.querySelectorAll('#country-list .list-item').forEach(item => {
                item.classList.remove('selected');
            });
            this.classList.add('selected');
        });
        countryList.appendChild(li);
    });

    console.log(`Populated country list for ${committee} with ${committeeCountries[committee].length} countries`);
}

// Function to add a country to the speaking list
function addToSpeakingList(country) {
    if (!country) {
        console.error("Attempted to add undefined country to speaking list");
        return;
    }

    state.speakerQueue.push(country);

    // Update frequency data
    if (!state.delegateData[country]) {
        state.delegateData[country] = {
            speaking: 0,
            votes: 0,
            notes: []
        };
    }
    state.delegateData[country].speaking++;

    console.log(`Added ${country} to speaking list`);
}

// Function to update speaking list display
function updateSpeakingList() {
    const speakingList = document.getElementById('speaking-list');
    if (!speakingList) return;

    speakingList.innerHTML = '';

    state.speakerQueue.forEach((country, index) => {
        const li = document.createElement('li');
        li.textContent = country;
        li.className = 'list-item';
        li.dataset.index = index;
        li.addEventListener('click', function() {
            document.querySelectorAll('#speaking-list .list-item').forEach(item => {
                item.classList.remove('selected');
            });
            this.classList.add('selected');
        });
        speakingList.appendChild(li);
    });

    console.log(`Updated speaking list with ${state.speakerQueue.length} countries`);
}
</script>
<script>
// Function to update frequency list
function updateFrequencyList() {
    const frequencyList = document.getElementById('frequency-list');
    if (!frequencyList) return;

    frequencyList.innerHTML = '';

    // Create array from delegate data
    const delegates = Object.keys(state.delegateData).map(country => {
        return {
            country: country,
            count: state.delegateData[country].speaking
        };
    });

    // Sort by speaking count descending
    delegates.sort((a, b) => b.count - a.count);

    delegates.forEach(delegate => {
        const li = document.createElement('li');
        li.className = 'list-item';

        // Determine color based on frequency
        let colorClass = '';
        if (delegate.count > 5) {
            colorClass = 'background-color: var(--danger);';
        } else if (delegate.count > 3) {
            colorClass = 'background-color: var(--warning);';
        } else if (delegate.count > 0) {
            colorClass = 'background-color: var(--success);';
        }

        li.innerHTML = `<span class="frequency-indicator" style="${colorClass}"></span>${delegate.country} - ${delegate.count}`;
        frequencyList.appendChild(li);
    });
}

// Function to calculate performance metrics for each delegate
function calculatePerformance(delegate) {
    // Get the delegate data
    const data = state.delegateData[delegate];
    if (!data || !data.notes || data.notes.length === 0) {
        return {
            goodSpeechCount: 0,
            badSpeechCount: 0,
            goodDiplomacyCount: 0,
            badDiplomacyCount: 0,
            totalNotes: 0,
            speechQuality: 0,
            diplomacyQuality: 0,
            overallPerformance: 0
        };
    }

    // Count the different types of notes
    let goodSpeechCount = 0;
    let badSpeechCount = 0;
    let goodDiplomacyCount = 0;
    let badDiplomacyCount = 0;

    data.notes.forEach(note => {
        if (note.text === 'Good Speech') {
            goodSpeechCount++;
        } else if (note.text === 'Bad Speech') {
            badSpeechCount++;
        } else if (note.text === 'Good Diplomacy') {
            goodDiplomacyCount++;
        } else if (note.text === 'Bad Diplomacy') {
            badDiplomacyCount++;
        }
    });

    const totalNotes = data.notes.length;

    // Calculate speech quality (percentage of good speeches)
    const totalSpeechNotes = goodSpeechCount + badSpeechCount;
    const speechQuality = totalSpeechNotes > 0 ? (goodSpeechCount / totalSpeechNotes) * 100 : 0;

    // Calculate diplomacy quality (percentage of good diplomacy)
    const totalDiplomacyNotes = goodDiplomacyCount + badDiplomacyCount;
    const diplomacyQuality = totalDiplomacyNotes > 0 ? (goodDiplomacyCount / totalDiplomacyNotes) * 100 : 0;

    // Calculate overall performance
    // If both types of notes exist, average them. Otherwise, use the one that exists.
    let overallPerformance = 0;
    if (totalSpeechNotes > 0 && totalDiplomacyNotes > 0) {
        overallPerformance = (speechQuality + diplomacyQuality) / 2;
    } else if (totalSpeechNotes > 0) {
        overallPerformance = speechQuality;
    } else if (totalDiplomacyNotes > 0) {
        overallPerformance = diplomacyQuality;
    }

    return {
        goodSpeechCount,
        badSpeechCount,
        goodDiplomacyCount,
        badDiplomacyCount,
        totalNotes,
        speechQuality,
        diplomacyQuality,
        overallPerformance
    };
}

// Function to update the performance list
function updatePerformanceList() {
    const performanceList = document.getElementById('performance-list');
    if (!performanceList) return;

    performanceList.innerHTML = '';

    // Get all delegates who have notes
    const delegatesWithNotes = Object.keys(state.delegateData)
        .filter(delegate => 
            state.delegateData[delegate].notes && 
            state.delegateData[delegate].notes.length > 0
        );

    // Calculate performance for each delegate
    const performances = delegatesWithNotes.map(delegate => {
        const performance = calculatePerformance(delegate);
        return {
            delegate,
            ...performance
        };
    });

    // Sort by overall performance (highest first)
    performances.sort((a, b) => b.overallPerformance - a.overallPerformance);

    // Create list items for each delegate
    performances.forEach(perf => {
        const li = document.createElement('li');
        li.className = 'list-item';

        // Determine color based on performance
        let colorClass = '';
        if (perf.overallPerformance >= 75) {
            colorClass = 'background-color: var(--success);';
        } else if (perf.overallPerformance >= 50) {
            colorClass = 'background-color: var(--warning);';
        } else {
            colorClass = 'background-color: var(--danger);';
        }

        // Format the performance details
        const speechDetails = perf.goodSpeechCount + perf.badSpeechCount > 0 
            ? `Speech: ${perf.speechQuality.toFixed(0)}% (${perf.goodSpeechCount}/${perf.goodSpeechCount + perf.badSpeechCount})` 
            : 'No speech data';

        const diplomacyDetails = perf.goodDiplomacyCount + perf.badDiplomacyCount > 0 
            ? `Diplomacy: ${perf.diplomacyQuality.toFixed(0)}% (${perf.goodDiplomacyCount}/${perf.goodDiplomacyCount + perf.badDiplomacyCount})` 
            : 'No diplomacy data';

        li.innerHTML = `
           <div>
               <span class="frequency-indicator" style="${colorClass}"></span>
               <strong>${perf.delegate}</strong> - ${perf.overallPerformance.toFixed(0)}%
           </div>
           <div style="font-size: 0.8rem; margin-left: 18px; color: var(--text-secondary);">
               ${speechDetails} | ${diplomacyDetails}
           </div>
       `;

        performanceList.appendChild(li);
    });

    // If no performances to show
    if (performances.length === 0) {
        const li = document.createElement('li');
        li.className = 'list-item';
        li.textContent = 'No performance data available yet. Take notes on speeches to see data here.';
        performanceList.appendChild(li);
    }
}

// Add function to toggle performance list visibility
function togglePerformanceList() {
    state.showPerformanceList = !state.showPerformanceList;

    const container = document.getElementById('performance-list-container');
    const toggleButton = document.getElementById('toggle-performance-button');

    if (container && toggleButton) {
        if (state.showPerformanceList) {
            container.style.display = 'block';
            toggleButton.textContent = 'Hide';
            updatePerformanceList();
        } else {
            container.style.display = 'none';
            toggleButton.textContent = 'Show';
        }
    }
}
</script>
<script>
function generateRoleCallTable() {
    const table = document.getElementById('role-call-table');
    if (!table) return;

    const headerRow = table.querySelector('thead tr');
    if (!headerRow) return;

    // Clear existing header cells except first one
    while (headerRow.children.length > 1) {
        headerRow.removeChild(headerRow.lastChild);
    }

    // Add date headers
    state.attendanceDates.forEach(date => {
        const th = document.createElement('th');
        th.textContent = date;
        headerRow.appendChild(th);
    });

    // Clear existing body rows
    const tbody = table.querySelector('tbody');
    if (!tbody) return;

    tbody.innerHTML = '';

    // Add country rows
    const countries = committeeCountries[state.selectedCommittee];
    countries.forEach(country => {
        const tr = document.createElement('tr');

        const td = document.createElement('td');
        td.textContent = country;
        tr.appendChild(td);

        // Add attendance cells
        state.attendanceDates.forEach(date => {
            const td = document.createElement('td');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';

            // Check if attendance data exists
            if (state.attendanceData[country] && state.attendanceData[country][date]) {
                checkbox.checked = true;
            }

            // Add change event
            checkbox.addEventListener('change', function() {
                if (!state.attendanceData[country]) {
                    state.attendanceData[country] = {};
                }
                state.attendanceData[country][date] = this.checked;
            });

            td.appendChild(checkbox);
            tr.appendChild(td);
        });

        tbody.appendChild(tr);
    });
}

// Setup the tab switching functionality
function setupTabSwitching() {
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');

            // Skip if disabled
            if (this.classList.contains('disabled')) {
                return;
            }

            // Update active tab
            tabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');

            // Update active content
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabName}-tab`) {
                    content.classList.add('active');
                }
            });
        });
    });
}

// Setup event listeners for various buttons and interactive elements
// Setup event listeners for various buttons and interactive elements
function setupEventListeners() {
    // Add timer settings event listeners
    document.querySelectorAll('.timer-set-button').forEach(button => {
        button.addEventListener('click', function() {
            const timerType = this.getAttribute('data-timer');
            const input = document.querySelector(`.timer-duration[data-timer="${timerType}"]`);

            if (input) {
                const minutes = parseInt(input.value);
                if (!isNaN(minutes) && minutes > 0) {
                    setTimerDuration(timerType, minutes);
                }
            }
        });
    });

    // Helper to safely add event listener
    function addSafeEventListener(id, event, callback) {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener(event, callback);
            return true;
        } else {
            console.warn(`Element with id ${id} not found for event listener`);
            return false;
        }
    }

    // Handle committee selection change
    addSafeEventListener('committee-select', 'change', function() {
        state.selectedCommittee = this.value;
        populateCountryList(state.selectedCommittee);
        updateFrequencyList();
    });

    // Add to speaking list button
    addSafeEventListener('add-to-list-button', 'click', function() {
        const selectedCountry = document.querySelector('#country-list .list-item.selected');
        if (selectedCountry) {
            const country = selectedCountry.textContent;
            addToSpeakingList(country);
            updateSpeakingList();
            updateFrequencyList();
        } else {
            console.log("No country selected to add to speaking list");
            alert("Please select a country to add to the speaking list.");
        }
    });

    // Add event listeners for timer buttons
    document.querySelectorAll('.timer-button').forEach(button => {
        button.addEventListener('click', function(event) {
            // Prevent default to be safe
            event.preventDefault();

            const timer = this.getAttribute('data-timer');
            const action = this.getAttribute('data-action');

            console.log(`Timer button clicked: ${timer} - ${action}`);

            if (action === 'start') {
                startTimer(timer);
            } else if (action === 'stop') {
                stopTimer(timer);
            } else if (action === 'reset') {
                resetTimer(timer);
            }
        });
    });

    // Next speaker button
    addSafeEventListener('next-speaker-button', 'click', function() {
        if (state.speakerQueue.length > 0) {
            if (state.currentSpeaker) {
                // Current speaker is done
                resetTimer('speech');
            }

            // Get next speaker
            state.currentSpeaker = state.speakerQueue.shift();
            const currentSpeakerDisplay = document.getElementById('current-speaker-display');
            if (currentSpeakerDisplay) {
                currentSpeakerDisplay.textContent = state.currentSpeaker;
            }

            // Start speech timer
            resetTimer('speech');
            startTimer('speech');

            // Update the displays
            updateSpeakingList();

            // If performance list is showing, update it too
            if (state.showPerformanceList) {
                updatePerformanceList();
            }
        } else {
            console.log("No speakers in queue");
            alert("No speakers in the queue.");
        }
    });

    // Skip speaker button
    addSafeEventListener('skip-speaker-button', 'click', function() {
        if (state.currentSpeaker) {
            resetTimer('speech');
            state.currentSpeaker = null;

            const currentSpeakerDisplay = document.getElementById('current-speaker-display');
            if (currentSpeakerDisplay) {
                currentSpeakerDisplay.textContent = 'None';
            }

            if (state.speakerQueue.length > 0) {
                state.currentSpeaker = state.speakerQueue.shift();
                if (currentSpeakerDisplay) {
                    currentSpeakerDisplay.textContent = state.currentSpeaker;
                }
                resetTimer('speech');
                startTimer('speech');
            }

            updateSpeakingList();
        }
    });
}
</script>
<script>
    // Speaking list controls
    addSafeEventListener('move-up-button', 'click', function() {
        const selected = document.querySelector('#speaking-list .list-item.selected');
        if (selected) {
            const index = parseInt(selected.dataset.index);
            if (index > 0) {
                // Swap with previous item
                [state.speakerQueue[index], state.speakerQueue[index - 1]] = [state.speakerQueue[index - 1], state.speakerQueue[index]];
                updateSpeakingList();

                // Keep the item selected
                const items = document.querySelectorAll('#speaking-list .list-item');
                if (items.length > index - 1) {
                    items[index - 1].classList.add('selected');
                }
            }
        }
    });

    addSafeEventListener('move-down-button', 'click', function() {
        const selected = document.querySelector('#speaking-list .list-item.selected');
        if (selected) {
            const index = parseInt(selected.dataset.index);
            if (index < state.speakerQueue.length - 1) {
                // Swap with next item
                [state.speakerQueue[index], state.speakerQueue[index + 1]] = [state.speakerQueue[index + 1], state.speakerQueue[index]];
                updateSpeakingList();

                // Keep the item selected
                const items = document.querySelectorAll('#speaking-list .list-item');
                if (items.length > index + 1) {
                    items[index + 1].classList.add('selected');
                }
            }
        }
    });

    addSafeEventListener('remove-button', 'click', function() {
        const selected = document.querySelector('#speaking-list .list-item.selected');
        if (selected) {
            const index = parseInt(selected.dataset.index);
            state.speakerQueue.splice(index, 1);
            updateSpeakingList();
        }
    });

    addSafeEventListener('clear-list-button', 'click', function() {
        if (confirm("Are you sure you want to clear the entire speaking list?")) {
            state.speakerQueue = [];
            updateSpeakingList();
        }
    });

    // Notes functionality
    document.querySelectorAll('.note-buttons .button').forEach(button => {
        button.addEventListener('click', function() {
            const noteText = this.getAttribute('data-note');
            const notesArea = document.getElementById('notes-area');

            if (state.currentSpeaker && notesArea) {
                const timestamp = new Date().toLocaleTimeString();
                const note = `[${timestamp}] ${state.currentSpeaker}: ${noteText}`;

                // Add to text area
                notesArea.value += (notesArea.value ? '\n' : '') + note;

                // Add to delegate data
                if (!state.delegateData[state.currentSpeaker]) {
                    state.delegateData[state.currentSpeaker] = {
                        speaking: 0,
                        votes: 0,
                        notes: []
                    };
                }

                state.delegateData[state.currentSpeaker].notes.push({
                    timestamp: timestamp,
                    text: noteText
                });

                console.log(`Added note for ${state.currentSpeaker}: ${noteText}`);

                // Update frequency list to reflect the new data
                updateFrequencyList();

                // If performance list is showing, update it too
                if (state.showPerformanceList) {
                    updatePerformanceList();
                }
            } else {
                console.warn('No current speaker selected for note taking');
                alert('Please select a current speaker before taking notes.');
            }
        });
    });

    // Lock countries functionality
    addSafeEventListener('lock-countries-button', 'click', function() {
        state.isCountryListLocked = !state.isCountryListLocked;

        const countryListItems = document.querySelectorAll('#country-list .list-item');
        if (state.isCountryListLocked) {
            this.textContent = 'Unlock Countries';
            countryListItems.forEach(item => {
                item.style.pointerEvents = 'none';
                item.style.opacity = '0.6';
            });
        } else {
            this.textContent = 'Lock Countries';
            countryListItems.forEach(item => {
                item.style.pointerEvents = 'auto';
                item.style.opacity = '1';
            });
        }
    });

    // Performance List Toggle
    addSafeEventListener('toggle-performance-button', 'click', togglePerformanceList);
}
</script>
<script>
// Fun Mode Functions
function initializeFunMode() {
    // Create a new state object to track fun mode state if it doesn't exist
    if (!state.funMode) {
        state.funMode = {
            activeGame: null,
            votes: {},
            winner: null,
            gameDescriptions: {
                'UN Charades': 'Each delegate acts out a UN resolution or international issue without speaking.',
                'Diplomatic Trivia': 'Test your knowledge of international relations, UN history, and global affairs.',
                'Resolution Writing Race': 'Teams race to draft the most comprehensive resolution in a limited time.',
                'Crisis Simulation': 'Delegates respond to a surprise international crisis with limited information.'
            },
            gameDurations: {
                'UN Charades': 300, // 5 minutes
                'Diplomatic Trivia': 600, // 10 minutes
                'Resolution Writing Race': 900, // 15 minutes
                'Crisis Simulation': 1200 // 20 minutes
            }
        };
    }

    // Reset votes and active game
    state.funMode.activeGame = null;
    state.funMode.votes = {};
    state.funMode.winner = null;

    // Reset votes on UI
    document.querySelectorAll('.game-option .vote-count').forEach(el => {
        el.textContent = '0';
    });

    // Remove any selected game
    document.querySelectorAll('.game-option.selected').forEach(el => {
        el.classList.remove('selected');
    });

    // Reset timer
    resetTimer('fun');

    // Hide winner display if exists
    const winnerDisplay = document.querySelector('.winner-display');
    if (winnerDisplay) {
        winnerDisplay.remove();
    }

    console.log('Fun Mode initialized');
}

function enhanceFunModeOptions() {
    // Get all game options
    const gameOptions = document.querySelectorAll('.game-option');
    
    gameOptions.forEach(option => {
        // Get the game name from the option
        const gameName = option.querySelector('span').textContent.split(' - ')[0];
        
        // Skip if this option already has a description
        if (option.querySelector('.game-description')) return;
        
        // Create description element
        const description = document.createElement('div');
        description.className = 'game-description';
        description.style.fontSize = '0.9rem';
        description.style.marginTop = '8px';
        description.style.opacity = '0.9';
        description.style.textAlign = 'left';
        description.textContent = state.funMode.gameDescriptions[gameName] || 'A fun diplomatic game.';
        
        // Create duration element
        const duration = document.createElement('div');
        duration.className = 'game-duration';
        duration.style.fontSize = '0.8rem';
        duration.style.marginTop = '5px';
        duration.style.opacity = '0.7';
        duration.style.textAlign = 'left';
        
        const minutes = (state.funMode.gameDurations[gameName] || 300) / 60;
        duration.textContent = `Duration: ${minutes} minutes`;
        
        // Add elements to the game option
        const textContainer = document.createElement('div');
        textContainer.style.flex = '1';
        
        // Get the existing text and vote count
        const existingSpan = option.querySelector('span').cloneNode(true);
        
        // Clear the option and rebuild it
        option.innerHTML = '';
        
        textContainer.appendChild(existingSpan);
        textContainer.appendChild(description);
        textContainer.appendChild(duration);
        
        option.appendChild(textContainer);
        
        // Recreate the vote button
        const voteButton = document.createElement('button');
        voteButton.className = 'button primary vote-button';
        voteButton.textContent = 'Vote';
        option.appendChild(voteButton);
        
        // Add click event to the game option itself
        option.addEventListener('click', function(e) {
            // Don't trigger if they click the vote button
            if (e.target.classList.contains('vote-button')) return;
            
            // Toggle selection
            gameOptions.forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            
            // Set as active game
            state.funMode.activeGame = gameName;
            
            // Update timer duration based on selected game
            if (state.funMode.gameDurations[gameName]) {
                state.timerDurations.fun = state.funMode.gameDurations[gameName];
                state.timerElapsed.fun = state.funMode.gameDurations[gameName];
                updateTimerDisplay('fun');
            }
        });
    });
    
    // Re-add event listeners for vote buttons
    document.querySelectorAll('.vote-button').forEach(button => {
        // Remove existing listeners to avoid duplicates
        const newButton = button.cloneNode(true);
        button.parentNode.replaceChild(newButton, button);
        
        newButton.addEventListener('click', function(e) {
            e.stopPropagation(); // Don't trigger parent click
            
            const gameOption = this.closest('.game-option');
            const gameName = gameOption.querySelector('span').textContent.split(' - ')[0];
            const voteCount = gameOption.querySelector('.vote-count');
            
            if (voteCount) {
                const currentCount = parseInt(voteCount.textContent);
                voteCount.textContent = currentCount + 1;
                
                // Store votes in state
                state.funMode.votes[gameName] = (state.funMode.votes[gameName] || 0) + 1;
                
                // Highlight the most voted option
                updateMostVotedGame();
            }
        });
    });
}
</script>
<script>
// Update the most voted game to be selected
function updateMostVotedGame() {
    let maxVotes = 0;
    let topGame = null;
    
    // Find game with most votes
    for (const [game, votes] of Object.entries(state.funMode.votes)) {
        if (votes > maxVotes) {
            maxVotes = votes;
            topGame = game;
        }
    }
    
    // Select the top game
    if (topGame) {
        document.querySelectorAll('.game-option').forEach(option => {
            const gameName = option.querySelector('span').textContent.split(' - ')[0];
            option.classList.toggle('selected', gameName === topGame);
            
            if (gameName === topGame) {
                state.funMode.activeGame = topGame;
                
                // Update timer duration based on selected game
                if (state.funMode.gameDurations[topGame]) {
                    state.timerDurations.fun = state.funMode.gameDurations[topGame];
                    state.timerElapsed.fun = state.funMode.gameDurations[topGame];
                    updateTimerDisplay('fun');
                }
            }
        });
    }
}

// Create confetti effect when a game is selected
function createConfetti() {
    const funModeContainer = document.getElementById('fun-mode-container');
    if (!funModeContainer) return;
    
    // Remove existing confetti
    document.querySelectorAll('.confetti').forEach(el => el.remove());
    
    // Create new confetti
    for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.width = `${Math.random() * 10 + 5}px`;
        confetti.style.height = `${Math.random() * 10 + 5}px`;
        confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
        confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
        confetti.style.animationDelay = `${Math.random() * 2}s`;
        
        funModeContainer.appendChild(confetti);
    }
    
    // Remove confetti after animation completes
    setTimeout(() => {
        document.querySelectorAll('.confetti').forEach(el => el.remove());
    }, 5000);
}

// Show a winner when the fun timer expires
function showGameWinner() {
    // Get a random country to be the winner
    const countries = committeeCountries[state.selectedCommittee];
    const randomIndex = Math.floor(Math.random() * countries.length);
    const winner = countries[randomIndex];
    
    state.funMode.winner = winner;
    
    // Create winner display
    const winnerDisplay = document.createElement('div');
    winnerDisplay.className = 'winner-display';
    
    winnerDisplay.innerHTML = `
        <div class="winner-title">Winner</div>
        <div class="winner-name">${winner}</div>
        <div>Congratulations!</div>
    `;
    
    // Add it to the DOM
    const funMode = document.querySelector('.fun-mode');
    
    // Remove existing winner display if any
    const existingWinner = funMode.querySelector('.winner-display');
    if (existingWinner) {
        existingWinner.remove();
    }
    
    // Insert before the exit button
    const exitButton = document.getElementById('exit-fun-mode-button');
    funMode.insertBefore(winnerDisplay, exitButton);
    
    // Add confetti
    createConfetti();
}

// Simple password authentication function
function authenticateWithPassword() {
    const CORRECT_PASSWORD = "munchair2023";
    
    // Create login dialog
    const loginDialog = document.createElement('div');
    loginDialog.style.position = 'fixed';
    loginDialog.style.top = '0';
    loginDialog.style.left = '0';
    loginDialog.style.width = '100%';
    loginDialog.style.height = '100%';
    loginDialog.style.backgroundColor = 'rgba(0,0,0,0.5)';
    loginDialog.style.display = 'flex';
    loginDialog.style.justifyContent = 'center';
    loginDialog.style.alignItems = 'center';
    loginDialog.style.zIndex = '9999';
    
    // Dialog content
    loginDialog.innerHTML = `
        <div style="background-color: white; padding: 20px; border-radius: 8px; width: 300px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
            <h3 style="margin-top: 0; color: #333;">MUN Chair Login</h3>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Username</label>
                <input id="auth-username-input" type="text" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Enter your name">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Password</label>
                <input id="auth-password-input" type="password" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Enter password">
                <div id="password-error" style="color: red; font-size: 12px; margin-top: 5px; display: none;">Incorrect password</div>
            </div>
            
            <div style="display: flex; justify-content: space-between;">
                <button id="auth-cancel-button" style="padding: 8px 15px; border: none; background-color: #f2f2f2; border-radius: 4px; cursor: pointer;">Cancel</button>
                <button id="auth-login-button" style="padding: 8px 15px; border: none; background-color: #6750A4; color: white; border-radius: 4px; cursor: pointer;">Login</button>
            </div>
        </div>
    `;
    
    document.body.appendChild(loginDialog);
    
    // Focus username input
    setTimeout(() => {
        document.getElementById('auth-username-input').focus();
    }, 100);
    
    // Add enter key press handler
    document.getElementById('auth-password-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            document.getElementById('auth-login-button').click();
        }
    });
    
    // Handle login button
    document.getElementById('auth-login-button').addEventListener('click', function() {
        const username = document.getElementById('auth-username-input').value;
        const password = document.getElementById('auth-password-input').value;
        
        if (password === CORRECT_PASSWORD) {
            // Password is correct
            document.body.removeChild(loginDialog);
            
            // Save authentication state
            state.isAuthenticated = true;
            state.authUser = {
                username: username || 'MUN Chair',
            };
            
            // Update UI
            updateAuthStatus();
            enableAuthFeatures();
            
            // Show success notification
            showNotification('Successfully authenticated', 'success');
        } else {
            // Password is incorrect
            document.getElementById('password-error').style.display = 'block';
            document.getElementById('auth-password-input').value = '';
            document.getElementById('auth-password-input').focus();
        }
    });
    
    // Handle cancel button
    document.getElementById('auth-cancel-button').addEventListener('click', function() {
        document.body.removeChild(loginDialog);
    });
}
</script>
<script>
// Function to show notifications
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.position = 'fixed';
    notification.style.bottom = '20px';
    notification.style.right = '20px';
    notification.style.padding = '10px 20px';
    notification.style.borderRadius = 'var(--corner-radius)';
    notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
    notification.style.zIndex = '1000';
    notification.style.maxWidth = '300px';
    notification.style.transition = 'opacity 0.5s';
    
    // Set color based on notification type
    if (type === 'success') {
        notification.style.backgroundColor = 'var(--success)';
        notification.style.color = 'white';
    } else if (type === 'warning') {
        notification.style.backgroundColor = 'var(--warning)';
        notification.style.color = 'white';
    } else if (type === 'error') {
        notification.style.backgroundColor = 'var(--danger)';
        notification.style.color = 'white';
    } else {
        notification.style.backgroundColor = 'var(--primary)';
        notification.style.color = 'white';
    }
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 500);
    }, 3000);
}

// Function to update authentication status in the UI
function updateAuthStatus() {
    const authUsername = document.getElementById('auth-username');
    const authButton = document.getElementById('auth-button');
    
    if (!authUsername || !authButton) return;
    
    if (state.isAuthenticated) {
        // User is authenticated
        authUsername.textContent = state.authUser.username;
        authButton.textContent = 'Logout';
        authButton.classList.remove('secondary');
        authButton.classList.add('success');
        
        // Update button click handler
        authButton.removeEventListener('click', authenticateWithPassword);
        authButton.addEventListener('click', logout);
    } else {
        // User is not authenticated
        authUsername.textContent = 'Not logged in';
        authButton.textContent = 'Login';
        authButton.classList.remove('success');
        authButton.classList.add('secondary');
        
        // Update button click handler
        authButton.removeEventListener('click', logout);
        authButton.addEventListener('click', authenticateWithPassword);
    }
}

// Logout function
function logout() {
    // Clear auth state
    state.isAuthenticated = false;
    state.authUser = null;
    
    // Update UI
    updateAuthStatus();
    
    // Disable auth-restricted features
    disableAuthFeatures();
    
    showNotification('Successfully logged out', 'info');
}

// Enable features that require authentication
function enableAuthFeatures() {
    // Enable messaging tab
    if (state.requiredAuthFeatures.includes('messaging')) {
        const messagingTab = document.querySelector('.tab[data-tab="messaging"]');
        if (messagingTab) {
            messagingTab.classList.remove('disabled');
        }
        
        // Show messaging interface if on that tab
        const messagingInterface = document.getElementById('messaging-interface');
        const authRequiredPanel = document.getElementById('auth-required-panel');
        
        if (messagingInterface && authRequiredPanel) {
            messagingInterface.style.display = 'block';
            authRequiredPanel.style.display = 'none';
        }
    }
    
    // Enable performance tracking
    if (state.requiredAuthFeatures.includes('performance')) {
        // Find the performance card
        const cards = document.querySelectorAll('.card');
        let performanceCard = null;
        
        for (const card of cards) {
            const header = card.querySelector('.card-header');
            if (header && header.textContent.includes('Speaker Performance')) {
                performanceCard = card;
                break;
            }
        }
        
        if (performanceCard) {
            performanceCard.style.opacity = '1';
            performanceCard.style.pointerEvents = 'auto';
            
            // Remove lock icon if present
            const lockIcon = performanceCard.querySelector('.lock-icon');
            if (lockIcon) {
                lockIcon.remove();
            }
        }
        
        // Enable toggle button
        const toggleButton = document.getElementById('toggle-performance-button');
        if (toggleButton) {
            toggleButton.disabled = false;
            toggleButton.style.opacity = '1';
            toggleButton.style.cursor = 'pointer';
        }
    }
}

// Disable features that require authentication
function disableAuthFeatures() {
    // Disable messaging tab
    if (state.requiredAuthFeatures.includes('messaging')) {
        const messagingTab = document.querySelector('.tab[data-tab="messaging"]');
        if (messagingTab) {
            messagingTab.classList.add('disabled');
            
            // If currently on messaging tab, switch to main
            if (messagingTab.classList.contains('active')) {
                document.querySelector('.tab[data-tab="main"]').click();
            }
        }
        
        // Hide messaging interface and show auth required panel
        const messagingInterface = document.getElementById('messaging-interface');
        const authRequiredPanel = document.getElementById('auth-required-panel');
        
        if (messagingInterface && authRequiredPanel) {
            messagingInterface.style.display = 'none';
            authRequiredPanel.style.display = 'block';
        }
    }
    
    // Disable performance tracking
    if (state.requiredAuthFeatures.includes('performance')) {
        // Find the performance card
        const cards = document.querySelectorAll('.card');
        let performanceCard = null;
        let performanceHeader = null;
        
        for (const card of cards) {
            const header = card.querySelector('.card-header');
            if (header && header.textContent.includes('Speaker Performance')) {
                performanceCard = card;
                performanceHeader = header;
                break;
            }
        }
        
        if (performanceCard) {
            performanceCard.style.opacity = '0.6';
            performanceCard.style.pointerEvents = 'none';
            
            // Add lock icon if not already present
            if (performanceHeader && !performanceHeader.querySelector('.lock-icon')) {
                const lockIcon = document.createElement('span');
                lockIcon.className = 'lock-icon';
                lockIcon.innerHTML = ' 🔒';
                lockIcon.title = 'Requires authentication';
                lockIcon.style.fontSize = '14px';
                performanceHeader.appendChild(lockIcon);
            }
        }
        
        // Disable toggle button
        const toggleButton = document.getElementById('toggle-performance-button');
        if (toggleButton) {
            toggleButton.disabled = true;
            toggleButton.style.opacity = '0.6';
            toggleButton.style.cursor = 'not-allowed';
        }
        
        // Hide performance list if visible
        if (state.showPerformanceList) {
            const performanceList = document.getElementById('performance-list-container');
            if (performanceList) {
                performanceList.style.display = 'none';
                state.showPerformanceList = false;
                
                if (toggleButton) {
                    toggleButton.textContent = 'Show';
                }
            }
        }
    }
}

// Set up the application
function initializeApp() {
    // Initialize with default committee
    populateCountryList(state.selectedCommittee);

    // Initialize timer displays
    updateTimerDisplay('session');
    updateTimerDisplay('caucus');
    updateTimerDisplay('speech');
    updateTimerDisplay('fun');

    // Initialize timer relationship indicators
    updateTimerRelationships();

    // Show initial suggestions if needed
    showTimerSuggestions();

    // Setup tab switching
    setupTabSwitching();

    // Setup event listeners for all buttons and interactive elements
    setupEventListeners();
    
    // Setup authentication system
    setupAuthSystem();
    
    console.log("MUN Committee Timer App initialized successfully");
}

// Initialize the application when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the app
    initializeApp();
    
    // Extra event listeners setup for fun mode
   // Extra event listeners setup for fun mode
    const funModeButton = document.getElementById('fun-mode-button');
    if (funModeButton) {
        funModeButton.addEventListener('click', function() {
            const appElement = document.getElementById('app');
            const funModeContainer = document.getElementById('fun-mode-container');
            
            if (appElement && funModeContainer) {
                // Initialize fun mode
                initializeFunMode();
                
                // Show fun mode container
                appElement.style.display = 'none';
                funModeContainer.style.display = 'block';
                
                // Reset fun timer
                resetTimer('fun');
                
                // Set up fun mode options
                enhanceFunModeOptions();
            }
        });
    }
    
    // Exit Fun Mode button
    const exitFunModeButton = document.getElementById('exit-fun-mode-button');
    if (exitFunModeButton) {
        exitFunModeButton.addEventListener('click', function() {
            const appElement = document.getElementById('app');
            const funModeContainer = document.getElementById('fun-mode-container');
            
            if (appElement && funModeContainer) {
                appElement.style.display = 'block';
                funModeContainer.style.display = 'none';
                stopTimer('fun');
            }
        });
    }
    
    // Fun Mode timer buttons
    document.querySelectorAll('[data-action="start-fun"], [data-action="stop-fun"], [data-action="reset-fun"]').forEach(button => {
        button.addEventListener('click', function() {
            const action = this.getAttribute('data-action');
            
            if (action === 'start-fun') {
                if (state.funMode.activeGame) {
                    startTimer('fun');
                } else {
                    alert('Please select a game before starting the timer!');
                }
            } else if (action === 'stop-fun') {
                stopTimer('fun');
            } else if (action === 'reset-fun') {
                resetTimer('fun');
            }
        });
    });

    // Initialize auth system
    function setupAuthSystem() {
        // Update messaging auth button to use our authentication
        const authMessagingButton = document.getElementById('auth-messaging-button');
        if (authMessagingButton) {
            authMessagingButton.textContent = 'Login to Access';
            authMessagingButton.addEventListener('click', authenticateWithPassword);
        }
        
        // Initial setup of auth-restricted features
        disableAuthFeatures();
        
        // Set up auth button in header
        const authButton = document.getElementById('auth-button');
        if (authButton) {
            authButton.textContent = 'Login';
            authButton.addEventListener('click', authenticateWithPassword);
        }
        
        // Update auth status display
        updateAuthStatus();
        
        // Make messaging tab appear disabled initially
        const messagingTab = document.querySelector('.tab[data-tab="messaging"]');
        if (messagingTab) {
            messagingTab.classList.add('disabled');
            
            // Add click handler to show auth notification if disabled
            messagingTab.addEventListener('click', function(e) {
                if (this.classList.contains('disabled')) {
                    e.preventDefault();
                    e.stopPropagation();
                    showNotification('Login required to use the messaging feature', 'warning');
                    authenticateWithPassword(); // Show login dialog immediately
                }
            });
        }
    }
    
    // Set up the initial authentication system
    setupAuthSystem();
    
    // Add performance auth check
    const togglePerformanceButton = document.getElementById('toggle-performance-button');
    if (togglePerformanceButton) {
        // Remove any existing listeners and create new one
        const newButton = togglePerformanceButton.cloneNode(true);
        togglePerformanceButton.parentNode.replaceChild(newButton, togglePerformanceButton);
        
        // Add listener with auth check
        newButton.addEventListener('click', function() {
            if (!state.isAuthenticated && state.requiredAuthFeatures.includes('performance')) {
                showNotification('Login required to use the performance tracking feature', 'warning');
                authenticateWithPassword(); // Show login dialog immediately
                return;
            }
            togglePerformanceList();
        });
    }
    
    console.log('DIPLOMACY MUN Committee Timer application loaded successfully');
});

// Debug helper function
function debugState() {
    console.log('Current state:', JSON.stringify(state, null, 2));
}
</script>
</body>
</html>
